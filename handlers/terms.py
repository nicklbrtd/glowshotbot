from aiogram import Router, F
from aiogram.types import Message, CallbackQuery, InlineKeyboardMarkup, InlineKeyboardButton

from keyboards.common import build_back_kb

router = Router(name="legal")

def _build_ack_keyboard(section: str) -> InlineKeyboardMarkup:
    """
    –ö–Ω–æ–ø–∫–∞ '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ', –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–∑–¥–µ–ª.
    section: 'terms' –∏–ª–∏ 'privacy' ‚Äî –ø—Ä–æ—Å—Ç–æ –¥–ª—è —Ä–∞–∑–ª–∏—á–µ–Ω–∏—è callback_data.
    """
    return InlineKeyboardMarkup(
        inline_keyboard=[
            [
                InlineKeyboardButton(
                    text="‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ",
                    callback_data=f"legal:{section}:ack",
                )
            ]
        ]
    )

@router.message(F.text == "/terms")
async def cmd_terms(message: Message):
    # –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ–±—ã –Ω–µ –ø–ª–æ–¥–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
    try:
        await message.delete()
    except Exception:
        # –ï—Å–ª–∏ –±–æ—Ç –Ω–µ –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–µ—Ç –ø—Ä–∞–≤ –∏ —Ç.–ø.) ‚Äî –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
        pass

    await message.answer(
        "üìú <b>–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è GlowShot</b>\n\n"
        "‚Ä¢ –ë–æ—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π.\n"
        "‚Ä¢ –ü—Ä–µ–º–∏—É–º –¥–∞—ë—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–æ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —á–µ—Å—Ç–Ω–æ—Å—Ç—å –æ—Ü–µ–Ω–æ–∫.\n"
        "‚Ä¢ –û–ø–ª–∞—Ç–∞ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è, –∫—Ä–æ–º–µ —Å–ª—É—á–∞–µ–≤ —è–≤–Ω—ã—Ö —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫.\n"
        "‚Ä¢ –ó–∞ –∫–æ–Ω—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –∑–∞–≥—Ä—É–∂–∞–µ—à—å, –æ—Ç–≤–µ—á–∞–µ—à—å —Ç—ã. –ó–∞–ø—Ä–µ—â—ë–Ω –Ω–µ–∑–∞–∫–æ–Ω–Ω—ã–π, —ç—Ä–æ—Ç–∏—á–µ—Å–∫–∏–π, –Ω–∞—Å–∏–ª—å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏ —Ç.–ø. –∫–æ–Ω—Ç–µ–Ω—Ç.\n"
        "‚Ä¢ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –±–æ—Ç–∞ –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª.\n\n"
        "–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º ‚Äî –ø–∏—à–∏ –≤ /support.",
        reply_markup=build_back_kb("terms"),
    )

@router.message(F.text == "/privacy")
async def cmd_privacy(message: Message):
    # –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ–±—ã –Ω–µ –ø–ª–æ–¥–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
    try:
        await message.delete()
    except Exception:
        # –ï—Å–ª–∏ –±–æ—Ç –Ω–µ –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–µ—Ç –ø—Ä–∞–≤ –∏ —Ç.–ø.) ‚Äî –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
        pass

    await message.answer(
        "üîê <b>–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ GlowShot</b>\n\n"
        "‚Ä¢ –ú—ã —Ö—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞: —Ç–≤–æ–π Telegram ID, –∏–º—è, –Ω–∏–∫, –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –≤ –±–æ—Ç–µ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ—Ü–µ–Ω–æ–∫.\n"
        "‚Ä¢ –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞.\n"
        "‚Ä¢ –§–æ—Ç–æ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∏–¥–µ file_id Telegram, —Å–∞–º–∏ —Ñ–∞–π–ª—ã –ª–µ–∂–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö Telegram.\n"
        "‚Ä¢ –ü–æ –∑–∞–ø—Ä–æ—Å—É —á–µ—Ä–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫—É –∞–∫–∫–∞—É–Ω—Ç –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤–º–µ—Å—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏.\n\n"
        "–ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ –¥–∞–Ω–Ω—ã–º ‚Äî –ø–∏—à–∏ –≤ /support.",
        reply_markup=build_back_kb("privacy"),
    )

@router.callback_query(F.data.startswith("legal:"))
async def legal_ack(callback: CallbackQuery):
    """
    –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ' –≤ —Ä–∞–∑–¥–µ–ª–∞—Ö /terms –∏ /privacy.
    –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–∞–∑–¥–µ–ª–æ–º, —á—Ç–æ–±—ã –Ω–µ –º—É—Å–æ—Ä–∏—Ç—å –≤ —á–∞—Ç–µ.
    """
    parts = callback.data.split(":")
    if len(parts) != 3 or parts[2] != "ack":
        # –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –ø—Ä–æ—Å—Ç–æ –æ—Ç–≤–µ—á–∞–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–Ω—ã–π callback, —á—Ç–æ–±—ã Telegram –Ω–µ —Ä—É–≥–∞–ª—Å—è
        await callback.answer()
        return

    try:
        await callback.message.delete()
    except Exception:
        # –ï—Å–ª–∏ –Ω–µ –º–æ–∂–µ–º —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, —Ö–æ—Ç—è –±—ã —É–±–µ—Ä—ë–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
        try:
            await callback.message.edit_reply_markup(reply_markup=None)
        except Exception:
            pass

    # –ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ callback (–±–µ–∑ –∞–ª–µ—Ä—Ç–∞), —á—Ç–æ–±—ã Telegram –Ω–µ —Å—á–∏—Ç–∞–ª –µ–≥–æ "–ø–æ–¥–≤–∏—Å—à–∏–º"
    await callback.answer("–†–∞–∑–¥–µ–ª –∑–∞–∫—Ä—ã—Ç ‚úÖ")